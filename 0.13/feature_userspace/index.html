
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.qmk.fm/0.13/feature_userspace/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Userspace: Sharing Code Between Keymaps - QMK Firmware Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#userspace-sharing-code-between-keymaps" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QMK Firmware Docs" class="md-header__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMK Firmware Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Userspace: Sharing Code Between Keymaps
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh-cn/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/es/" hreflang="es" class="md-select__link">
                    Español
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/fr-fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/he-il/" hreflang="he" class="md-select__link">
                    עברית
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/pt-br/" hreflang="pt" class="md-select__link">
                    Português
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/ru-ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/ja/" hreflang="ja" class="md-select__link">
                    日本語
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Quantum Mechanical Keyboard Firmware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QMK Firmware Docs" class="md-nav__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    QMK Firmware Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Quantum Mechanical Keyboard Firmware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rulesmk" class="md-nav__link">
    Rules.mk
  </a>
  
    <nav class="md-nav" aria-label="Rules.mk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#override-default-userspace" class="md-nav__link">
    Override default userspace
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options-configh" class="md-nav__link">
    Configuration Options (config.h)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readme-readmemd" class="md-nav__link">
    Readme (readme.md)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-all-keyboards-that-support-a-specific-keymap" class="md-nav__link">
    Build All Keyboards That Support a Specific Keymap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customized-functions" class="md-nav__link">
    Customized Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-features" class="md-nav__link">
    Custom Features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consolidated-macros" class="md-nav__link">
    Consolidated Macros
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qmk/qmk_firmware/edit/master/docs/feature_userspace.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="userspace-sharing-code-between-keymaps">Userspace: Sharing Code Between Keymaps<a class="headerlink" href="#userspace-sharing-code-between-keymaps" title="Permanent link">&para;</a></h1>
<p>If you use more than one keyboard with a similar keymap, you might see the benefit in being able to share code between them. Create your own folder in <code>users/</code> named the same as your keymap (ideally your GitHub username, <code>&lt;name&gt;</code>) with the following structure:</p>
<ul>
<li><code>/users/&lt;name&gt;/</code> (added to the path automatically)</li>
<li><code>readme.md</code> (optional, recommended)</li>
<li><code>rules.mk</code> (included automatically)</li>
<li><code>config.h</code> (included automatically)</li>
<li><code>&lt;name&gt;.h</code> (optional)</li>
<li><code>&lt;name&gt;.c</code> (optional)</li>
<li><code>cool_rgb_stuff.c</code> (optional)</li>
<li><code>cool_rgb_stuff.h</code> (optional)</li>
</ul>
<p>All this only happens when you build a keymap named <code>&lt;name&gt;</code>, like this:</p>
<div class="codehilite"><pre><span></span><code>make planck:&lt;name&gt;
</code></pre></div>

<p>For example,</p>
<div class="codehilite"><pre><span></span><code>make planck:jack
</code></pre></div>

<p>Will include the <code>/users/jack/</code> folder in the path, along with <code>/users/jack/rules.mk</code>.  </p>
<p>!&gt; This <code>name</code> can be <a href="#override-default-userspace">overridden</a>, if needed.  </p>
<h2 id="rulesmk"><code>Rules.mk</code><a class="headerlink" href="#rulesmk" title="Permanent link">&para;</a></h2>
<p>The <code>rules.mk</code> is one of the two files that gets processed automatically.  This is how you add additional source files (such as  <code>&lt;name&gt;.c</code>) will be added when compiling.</p>
<p>It's highly recommended that you use <code>&lt;name&gt;.c</code> as the default source file to be added. And to add it, you need to add it the SRC in <code>rules.mk</code> like this:</p>
<div class="codehilite"><pre><span></span><code>SRC += &lt;name&gt;.c
</code></pre></div>

<p>Additional files may be added in the same way - it's recommended you have one named <code>&lt;name&gt;</code>.c/.h to start off with, though. </p>
<p>The <code>/users/&lt;name&gt;/rules.mk</code> file will be included in the build <em>after</em> the <code>rules.mk</code> from your keymap. This allows you to have features in your userspace <code>rules.mk</code> that depend on individual QMK features that may or may not be available on a specific keyboard. </p>
<p>For example, if you have RGB control features shared between all your keyboards that support RGB lighting, you can add support for that if the RGBLIGHT feature is enabled:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">ifeq ($(strip $(RGBLIGHT_ENABLE)), yes)</span>
<span class="c">  # Include my fancy rgb functions source here</span>
  <span class="nv">SRC</span> <span class="o">+=</span> cool_rgb_stuff.c
<span class="cp">endif</span>
</code></pre></div>

<p>Alternatively, you can <code>define RGB_ENABLE</code> in your keymap's <code>rules.mk</code> and then check for the variable in your userspace's <code>rules.mk</code> like this:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">ifdef RGB_ENABLE</span>
<span class="c">  # Include my fancy rgb functions source here</span>
  <span class="nv">SRC</span> <span class="o">+=</span> cool_rgb_stuff.c
<span class="cp">endif</span>
</code></pre></div>

<h3 id="override-default-userspace">Override default userspace<a class="headerlink" href="#override-default-userspace" title="Permanent link">&para;</a></h3>
<p>By default the userspace used will be the same as the keymap name. In some situations this isn't desirable. For instance, if you use the <a href="../feature_layouts/">layout</a> feature you can't use the same name for different keymaps (e.g. ANSI and ISO). You can name your layouts <code>mylayout-ansi</code> and <code>mylayout-iso</code> and add the following line to your layout's <code>rules.mk</code>:</p>
<div class="codehilite"><pre><span></span><code>USER_NAME := mylayout
</code></pre></div>

<p>This is also useful if you have multiple different keyboards with different features physically present on the board (such as one with RGB Lights, and one with Audio, or different number of LEDs, or connected to a different PIN on the controller).</p>
<h2 id="configuration-options-configh">Configuration Options (<code>config.h</code>)<a class="headerlink" href="#configuration-options-configh" title="Permanent link">&para;</a></h2>
<p>Additionally, <code>config.h</code> here will be processed like the same file in your keymap folder.  This is handled separately from the <code>&lt;name&gt;.h</code> file.</p>
<p>The reason for this, is that <code>&lt;name&gt;.h</code> won't be added in time to add settings (such as <code>#define TAPPING_TERM 100</code>), and including the <code>&lt;name.h&gt;</code> file in any <code>config.h</code> files will result in compile issues.</p>
<p>!&gt;You should use the <code>config.h</code> for <a href="../config_options/">configuration options</a>, and the <code>&lt;name&gt;.h</code> file for user or keymap specific settings (such as the enum for layer or keycodes)</p>
<h2 id="readme-readmemd">Readme (<code>readme.md</code>)<a class="headerlink" href="#readme-readmemd" title="Permanent link">&para;</a></h2>
<p>Please include authorship (your name, GitHub username, email), and optionally <a href="https://www.gnu.org/licenses/license-list.html#GPLCompatibleLicenses">a license that's GPL compatible</a>.</p>
<p>You can use this as a template: </p>
<div class="codehilite"><pre><span></span><code>Copyright &lt;year&gt; &lt;name&gt; &lt;email&gt; @&lt;github_username&gt;

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</code></pre></div>

<p>You'd want to replace the year, name, email and GitHub username with your info. </p>
<p>Additionally, this is a good place to document your code, if you wish to share it with others. </p>
<h2 id="build-all-keyboards-that-support-a-specific-keymap">Build All Keyboards That Support a Specific Keymap<a class="headerlink" href="#build-all-keyboards-that-support-a-specific-keymap" title="Permanent link">&para;</a></h2>
<p>Want to check all your keymaps build in a single command? You can run:</p>
<div class="codehilite"><pre><span></span><code>make all:&lt;name&gt;
</code></pre></div>

<p>For example,</p>
<div class="codehilite"><pre><span></span><code>make all:jack
</code></pre></div>

<p>This is ideal for when you want ensure everything compiles successfully when preparing a <a href="https://github.com/qmk/qmk_firmware/pulls"><em>Pull request</em></a>.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>For a brief example, checkout <a href="https://github.com/qmk/qmk_firmware/tree/master/users/_example"><code>/users/_example/</code></a>.<br />
For a more complicated example, checkout <a href="https://github.com/qmk/qmk_firmware/tree/master/users/drashna"><code>/users/drashna/</code></a>'s userspace.</p>
<h3 id="customized-functions">Customized Functions<a class="headerlink" href="#customized-functions" title="Permanent link">&para;</a></h3>
<p>QMK has a bunch of <a href="../custom_quantum_functions/">functions</a> that have <a href="../custom_quantum_functions/#a-word-on-core-vs-keyboards-vs-keymap"><code>_quantum</code>, <code>_kb</code>, and <code>_user</code> versions</a> that you can use.  You will pretty much always want to use the user version of these functions.  But the problem is that if you use them in your userspace, then you don't have a version that you can use in your keymap. </p>
<p>However, you can actually add support for keymap version, so that you can use it in both your userspace and your keymap! </p>
<p>For instance, let's look at the <code>layer_state_set_user()</code> function.  You can enable the <a href="../ref_functions/#olkb-tri-layers">Tri Layer State</a> functionality on all of your boards, while also retaining the Tri Layer functionality in your <code>keymap.c</code> files. </p>
<p>In your <code>&lt;name.c&gt;</code> file, you'd want to add this: </p>
<div class="codehilite"><pre><span></span><code><span class="n">__attribute__</span> <span class="p">((</span><span class="n">weak</span><span class="p">))</span>
<span class="n">layer_state_t</span> <span class="n">layer_state_set_keymap</span> <span class="p">(</span><span class="n">layer_state_t</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">state</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">layer_state_t</span> <span class="n">layer_state_set_user</span> <span class="p">(</span><span class="n">layer_state_t</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">state</span> <span class="o">=</span> <span class="n">update_tri_layer_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">layer_state_set_keymap</span> <span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The <code>__attribute__ ((weak))</code> part tells the compiler that this is a placeholder function that can then be replaced by a version in your <code>keymap.c</code>.  That way, you don't need to add it to your <code>keymap.c</code>, but if you do, you won't get any conflicts because the function is the same name. </p>
<p>The <code>_keymap</code> part here doesn't matter, it just needs to be something other than <code>_quantum</code>, <code>_kb</code>, or <code>_user</code>, since those are already in use. So you could use <code>layer_state_set_mine</code>, <code>layer_state_set_fn</code>, or anything else.</p>
<p>You can see a list of this and other common functions in <a href="https://github.com/qmk/qmk_firmware/blob/master/users/drashna/template.c"><code>template.c</code></a> in <a href="https://github.com/qmk/qmk_firmware/tree/master/users/drashna"><code>users/drashna</code></a>.</p>
<h3 id="custom-features">Custom Features<a class="headerlink" href="#custom-features" title="Permanent link">&para;</a></h3>
<p>Since the Userspace feature can support a staggering number of boards, you may have boards that you want to enable certain functionality for, but not for others. And you can actually create "features" that you can enable or disable in your own userspace.  </p>
<p>For instance, if you wanted to have a bunch of macros available, but only on certain boards (to save space), you could "hide" them being a <code>#ifdef MACROS_ENABLED</code>, and then enable it per board.  To do this, add this to your rules.mk</p>
<div class="codehilite"><pre><span></span><code><span class="cp">ifeq ($(strip $(MACROS_ENABLED)), yes)</span>
    <span class="nv">OPT_DEFS</span> <span class="o">+=</span> -DMACROS_ENABLED
<span class="cp">endif</span>
</code></pre></div>

<p>The <code>OPT_DEFS</code> setting causes <code>MACROS_ENABLED</code> to be defined for your keyboards (note the <code>-D</code> in front of the name), and you could use <code>#ifdef MACROS_ENABLED</code> to check the status in your c/h files, and handle that code based on that. </p>
<p>Then you add <code>MACROS_ENABLED = yes</code> to the <code>rules.mk</code> for you keymap to enable this feature and the code in your userspace.</p>
<p>And in your <code>process_record_user</code> function, you'd do something like this: </p>
<div class="codehilite"><pre><span></span><code><span class="kt">bool</span> <span class="nf">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef MACROS_ENABLED</span>
  <span class="k">case</span> <span class="nl">MACRO1</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">&quot;This is macro 1!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">MACRO2</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">&quot;This is macro 2!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="consolidated-macros">Consolidated Macros<a class="headerlink" href="#consolidated-macros" title="Permanent link">&para;</a></h3>
<p>If you wanted to consolidate macros and other functions into your userspace for all of your keymaps, you can do that.  This builds upon the <a href="#customized-functions">Customized Functions</a> example above. This lets you maintain a bunch of macros that are shared between the different keyboards, and allow for keyboard specific macros, too. </p>
<p>First, you'd want to go through all of your <code>keymap.c</code> files and replace <code>process_record_user</code> with <code>process_record_keymap</code> instead.   This way, you can still use keyboard specific codes on those boards, and use your custom "global" keycodes as well.   You'll also want to replace <code>SAFE_RANGE</code> with <code>NEW_SAFE_RANGE</code> so that you wont have any overlapping keycodes</p>
<p>Then add <code>#include "&lt;name&gt;.h"</code> to all of your keymap.c files.  This allows you to use these new keycodes without having to redefine them in each keymap.</p>
<p>Once you've done that, you'll want to set the keycode definitions that you need to the <code>&lt;name&gt;.h</code>  file. For instance:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">&quot;quantum.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;action.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;version.h&quot;</span><span class="cp"></span>

<span class="c1">// Define all of</span>
<span class="k">enum</span> <span class="n">custom_keycodes</span> <span class="p">{</span>
  <span class="n">KC_MAKE</span> <span class="o">=</span> <span class="n">SAFE_RANGE</span><span class="p">,</span>
  <span class="n">NEW_SAFE_RANGE</span>  <span class="c1">//use &quot;NEW_SAFE_RANGE&quot; for keymap specific codes</span>
<span class="p">};</span>
</code></pre></div>

<p>Now you want to create the <code>&lt;name&gt;.c</code> file, and add this content to it:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;&lt;name&gt;.h&quot;</span><span class="cp"></span>

<span class="n">__attribute__</span> <span class="p">((</span><span class="n">weak</span><span class="p">))</span>
<span class="kt">bool</span> <span class="n">process_record_keymap</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">KC_MAKE</span><span class="p">:</span>  <span class="c1">// Compiles the firmware, and adds the flash command based on keyboard bootloader</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint8_t</span> <span class="n">temp_mod</span> <span class="o">=</span> <span class="n">get_mods</span><span class="p">();</span>
            <span class="kt">uint8_t</span> <span class="n">temp_osm</span> <span class="o">=</span> <span class="n">get_oneshot_mods</span><span class="p">();</span>
            <span class="n">clear_mods</span><span class="p">();</span> <span class="n">clear_oneshot_mods</span><span class="p">();</span>
            <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">&quot;make &quot;</span> <span class="n">QMK_KEYBOARD</span> <span class="s">&quot;:&quot;</span> <span class="n">QMK_KEYMAP</span><span class="p">);</span>
    <span class="cp">#ifndef FLASH_BOOTLOADER</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">temp_mod</span> <span class="o">|</span> <span class="n">temp_osm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MOD_MASK_SHIFT</span><span class="p">)</span>
    <span class="cp">#endif</span>
            <span class="p">{</span>
                <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">&quot;:flash&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">temp_mod</span> <span class="o">|</span> <span class="n">temp_osm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MOD_MASK_CTRL</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">&quot; -j8 --output-sync&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">tap_code</span><span class="p">(</span><span class="n">KC_ENT</span><span class="p">);</span>
            <span class="n">set_mods</span><span class="p">(</span><span class="n">temp_mod</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>

  <span class="p">}</span>
  <span class="k">return</span> <span class="n">process_record_keymap</span><span class="p">(</span><span class="n">keycode</span><span class="p">,</span> <span class="n">record</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>For boards that may not have a shift button (such as on a macro pad), we need a way to always include the bootloader option.  To do that, add the following to the <code>rules.mk</code> in your userspace folder: </p>
<div class="codehilite"><pre><span></span><code><span class="cp">ifeq ($(strip $(FLASH_BOOTLOADER)), yes)</span>
    <span class="nv">OPT_DEFS</span> <span class="o">+=</span> -DFLASH_BOOTLOADER
<span class="cp">endif</span>
</code></pre></div>

<p>This will add a new <code>KC_MAKE</code> keycode that can be used in any of your keymaps.  And this keycode will output <code>make &lt;keyboard&gt;:&lt;keymap&gt;</code>, making frequent compiling easier.  And this will work with any keyboard and any keymap as it will output the current boards info, so that you don't have to type this out every time.</p>
<p>Also, holding Shift will add the flash target (<code>:flash</code>) to the command.  Holding Control will add some commands that will speed up compiling time by processing multiple files at once. </p>
<p>And for the boards that lack a shift key, or that you want to always attempt the flashing part, you can add <code>FLASH_BOOTLOADER = yes</code> to the <code>rules.mk</code> of that keymap.</p>
<p>?&gt; This should flash the newly compiled firmware automatically, using the correct utility, based on the bootloader settings (or default to just generating the HEX file). However, it should be noted that this may not work on all systems. AVRDUDE doesn't work on WSL, namely. And this doesn't support BootloadHID or mdloader. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>