
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.qmk.fm/0.13/spi_driver/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>SPI Master Driver - QMK Firmware Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spi-master-driver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QMK Firmware Docs" class="md-header__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMK Firmware Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SPI Master Driver
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="../README.md" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../zh-cn/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../es/" hreflang="es" class="md-select__link">
                    Español
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../fr-fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../he-il/" hreflang="he" class="md-select__link">
                    עברית
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../pt-br/" hreflang="pt" class="md-select__link">
                    Português
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ru-ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ja/" hreflang="ja" class="md-select__link">
                    日本語
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Quantum Mechanical Keyboard Firmware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QMK Firmware Docs" class="md-nav__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    QMK Firmware Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Quantum Mechanical Keyboard Firmware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#avr-configuration" class="md-nav__link">
    AVR Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chibiosarm-configuration" class="md-nav__link">
    ChibiOS/ARM Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#void-spi_initvoid" class="md-nav__link">
    void spi_init(void)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bool-spi_startpin_t-slavepin-bool-lsbfirst-uint8_t-mode-uint16_t-divisor" class="md-nav__link">
    bool spi_start(pin_t slavePin, bool lsbFirst, uint8_t mode, uint16_t divisor)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_status_t-spi_writeuint8_t-data" class="md-nav__link">
    spi_status_t spi_write(uint8_t data)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_status_t-spi_readvoid" class="md-nav__link">
    spi_status_t spi_read(void)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_status_t-spi_transmitconst-uint8_t-data-uint16_t-length" class="md-nav__link">
    spi_status_t spi_transmit(const uint8_t *data, uint16_t length)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_status_t-spi_receiveuint8_t-data-uint16_t-length" class="md-nav__link">
    spi_status_t spi_receive(uint8_t *data, uint16_t length)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#void-spi_stopvoid" class="md-nav__link">
    void spi_stop(void)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qmk/qmk_firmware/edit/master/docs/spi_driver.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="spi-master-driver">SPI Master Driver<a class="headerlink" href="#spi-master-driver" title="Permanent link">&para;</a></h1>
<p>The SPI Master drivers used in QMK have a set of common functions to allow portability between MCUs.</p>
<h2 id="avr-configuration">AVR Configuration<a class="headerlink" href="#avr-configuration" title="Permanent link">&para;</a></h2>
<p>No special setup is required - just connect the <code>SS</code>, <code>SCK</code>, <code>MOSI</code> and <code>MISO</code> pins of your SPI devices to the matching pins on the MCU:</p>
<table>
<thead>
<tr>
<th>MCU</th>
<th><code>SS</code></th>
<th><code>SCK</code></th>
<th><code>MOSI</code></th>
<th><code>MISO</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>ATmega16/32U2/4</td>
<td><code>B0</code></td>
<td><code>B1</code></td>
<td><code>B2</code></td>
<td><code>B3</code></td>
</tr>
<tr>
<td>AT90USB64/128/162</td>
<td><code>B0</code></td>
<td><code>B1</code></td>
<td><code>B2</code></td>
<td><code>B3</code></td>
</tr>
<tr>
<td>ATmega32A</td>
<td><code>B4</code></td>
<td><code>B7</code></td>
<td><code>B5</code></td>
<td><code>B6</code></td>
</tr>
<tr>
<td>ATmega328/P</td>
<td><code>B2</code></td>
<td><code>B5</code></td>
<td><code>B3</code></td>
<td><code>B4</code></td>
</tr>
</tbody>
</table>
<p>You may use more than one slave select pin, not just the <code>SS</code> pin. This is useful when you have multiple devices connected and need to communicate with them individually.
<code>SPI_SS_PIN</code> can be passed to <code>spi_start()</code> to refer to <code>SS</code>.</p>
<h2 id="chibiosarm-configuration">ChibiOS/ARM Configuration<a class="headerlink" href="#chibiosarm-configuration" title="Permanent link">&para;</a></h2>
<p>You'll need to determine which pins can be used for SPI -- as an example, STM32 parts generally have multiple SPI peripherals, labeled SPI1, SPI2, SPI3 etc.</p>
<p>To enable SPI, modify your board's <code>halconf.h</code> to enable SPI:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define HAL_USE_SPI TRUE</span>
<span class="cp">#define SPI_USE_WAIT TRUE</span>
<span class="cp">#define SPI_SELECT_MODE SPI_SELECT_MODE_PAD</span>
</code></pre></div>

<p>Then, modify your board's <code>mcuconf.h</code> to enable the peripheral you've chosen, for example:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#undef STM32_SPI_USE_SPI2</span>
<span class="cp">#define STM32_SPI_USE_SPI2 TRUE</span>
</code></pre></div>

<p>Configuration-wise, you'll need to set up the peripheral as per your MCU's datasheet -- the defaults match the pins for a Proton-C, i.e. STM32F303.</p>
<table>
<thead>
<tr>
<th><code>config.h</code> Override</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SPI_DRIVER</code></td>
<td>SPI peripheral to use - SPI1 -&gt; <code>SPID1</code>, SPI2 -&gt; <code>SPID2</code> etc.</td>
<td><code>SPID2</code></td>
</tr>
<tr>
<td><code>SPI_SCK_PIN</code></td>
<td>The pin to use for SCK</td>
<td><code>B13</code></td>
</tr>
<tr>
<td><code>SPI_SCK_PAL_MODE</code></td>
<td>The alternate function mode for SCK</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>SPI_MOSI_PIN</code></td>
<td>The pin to use for MOSI</td>
<td><code>B15</code></td>
</tr>
<tr>
<td><code>SPI_MOSI_PAL_MODE</code></td>
<td>The alternate function mode for MOSI</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>SPI_MISO_PIN</code></td>
<td>The pin to use for MISO</td>
<td><code>B14</code></td>
</tr>
<tr>
<td><code>SPI_MISO_PAL_MODE</code></td>
<td>The alternate function mode for MISO</td>
<td><code>5</code></td>
</tr>
</tbody>
</table>
<p>As per the AVR configuration, you may choose any other standard GPIO as a slave select pin, which should be supplied to <code>spi_start()</code>.</p>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<h3 id="void-spi_initvoid"><code>void spi_init(void)</code><a class="headerlink" href="#void-spi_initvoid" title="Permanent link">&para;</a></h3>
<p>Initialize the SPI driver. This function must be called only once, before any of the below functions can be called.</p>
<hr />
<h3 id="bool-spi_startpin_t-slavepin-bool-lsbfirst-uint8_t-mode-uint16_t-divisor"><code>bool spi_start(pin_t slavePin, bool lsbFirst, uint8_t mode, uint16_t divisor)</code><a class="headerlink" href="#bool-spi_startpin_t-slavepin-bool-lsbfirst-uint8_t-mode-uint16_t-divisor" title="Permanent link">&para;</a></h3>
<p>Start an SPI transaction.</p>
<h4 id="arguments">Arguments<a class="headerlink" href="#arguments" title="Permanent link">&para;</a></h4>
<ul>
<li><code>pin_t slavePin</code><br />
   The QMK pin to assert as the slave select pin, eg. <code>B4</code>.</li>
<li><code>bool lsbFirst</code><br />
   Determines the endianness of the transmission. If <code>true</code>, the least significant bit of each byte is sent first.</li>
<li><code>uint8_t mode</code><br />
   The SPI mode to use:</li>
</ul>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Clock Polarity</th>
<th>Clock Phase</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td>Leading edge rising</td>
<td>Sample on leading edge</td>
</tr>
<tr>
<td><code>1</code></td>
<td>Leading edge rising</td>
<td>Sample on trailing edge</td>
</tr>
<tr>
<td><code>2</code></td>
<td>Leading edge falling</td>
<td>Sample on leading edge</td>
</tr>
<tr>
<td><code>3</code></td>
<td>Leading edge falling</td>
<td>Sample on trailing edge</td>
</tr>
</tbody>
</table>
<ul>
<li><code>uint16_t divisor</code><br />
   The SPI clock divisor, will be rounded up to the nearest power of two. This number can be calculated by dividing the MCU's clock speed by the desired SPI clock speed. For example, an MCU running at 8 MHz wanting to talk to an SPI device at 4 MHz would set the divisor to <code>2</code>.</li>
</ul>
<h4 id="return-value">Return Value<a class="headerlink" href="#return-value" title="Permanent link">&para;</a></h4>
<p><code>false</code> if the supplied parameters are invalid or the SPI peripheral is already in use, or <code>true</code>.</p>
<hr />
<h3 id="spi_status_t-spi_writeuint8_t-data"><code>spi_status_t spi_write(uint8_t data)</code><a class="headerlink" href="#spi_status_t-spi_writeuint8_t-data" title="Permanent link">&para;</a></h3>
<p>Write a byte to the selected SPI device.</p>
<h4 id="arguments_1">Arguments<a class="headerlink" href="#arguments_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>uint8_t data</code><br />
   The byte to write.</li>
</ul>
<h4 id="return-value_1">Return Value<a class="headerlink" href="#return-value_1" title="Permanent link">&para;</a></h4>
<p><code>SPI_STATUS_TIMEOUT</code> if the timeout period elapses, or <code>SPI_STATUS_SUCCESS</code>.</p>
<hr />
<h3 id="spi_status_t-spi_readvoid"><code>spi_status_t spi_read(void)</code><a class="headerlink" href="#spi_status_t-spi_readvoid" title="Permanent link">&para;</a></h3>
<p>Read a byte from the selected SPI device.</p>
<h4 id="return-value_2">Return Value<a class="headerlink" href="#return-value_2" title="Permanent link">&para;</a></h4>
<p><code>SPI_STATUS_TIMEOUT</code> if the timeout period elapses, or the byte read from the device.</p>
<hr />
<h3 id="spi_status_t-spi_transmitconst-uint8_t-data-uint16_t-length"><code>spi_status_t spi_transmit(const uint8_t *data, uint16_t length)</code><a class="headerlink" href="#spi_status_t-spi_transmitconst-uint8_t-data-uint16_t-length" title="Permanent link">&para;</a></h3>
<p>Send multiple bytes to the selected SPI device.</p>
<h4 id="arguments_2">Arguments<a class="headerlink" href="#arguments_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>const uint8_t *data</code><br />
   A pointer to the data to write from.</li>
<li><code>uint16_t length</code><br />
   The number of bytes to write. Take care not to overrun the length of <code>data</code>.</li>
</ul>
<h4 id="return-value_3">Return Value<a class="headerlink" href="#return-value_3" title="Permanent link">&para;</a></h4>
<p><code>SPI_STATUS_TIMEOUT</code> if the timeout period elapses, <code>SPI_STATUS_ERROR</code> if some other error occurs, otherwise <code>SPI_STATUS_SUCCESS</code>.</p>
<hr />
<h3 id="spi_status_t-spi_receiveuint8_t-data-uint16_t-length"><code>spi_status_t spi_receive(uint8_t *data, uint16_t length)</code><a class="headerlink" href="#spi_status_t-spi_receiveuint8_t-data-uint16_t-length" title="Permanent link">&para;</a></h3>
<p>Receive multiple bytes from the selected SPI device.</p>
<h4 id="arguments_3">Arguments<a class="headerlink" href="#arguments_3" title="Permanent link">&para;</a></h4>
<ul>
<li><code>uint8_t *data</code><br />
   A pointer to the buffer to read into.</li>
<li><code>uint16_t length</code><br />
   The number of bytes to read. Take care not to overrun the length of <code>data</code>.</li>
</ul>
<h4 id="return-value_4">Return Value<a class="headerlink" href="#return-value_4" title="Permanent link">&para;</a></h4>
<p><code>SPI_STATUS_TIMEOUT</code> if the timeout period elapses, <code>SPI_STATUS_ERROR</code> if some other error occurs, otherwise <code>SPI_STATUS_SUCCESS</code>.</p>
<hr />
<h3 id="void-spi_stopvoid"><code>void spi_stop(void)</code><a class="headerlink" href="#void-spi_stopvoid" title="Permanent link">&para;</a></h3>
<p>End the current SPI transaction. This will deassert the slave select pin and reset the endianness, mode and divisor configured by <code>spi_start()</code>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>