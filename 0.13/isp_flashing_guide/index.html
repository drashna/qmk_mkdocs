
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.qmk.fm/0.13/isp_flashing_guide/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>ISP Flashing Guide - QMK Firmware Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#isp-flashing-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QMK Firmware Docs" class="md-header__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMK Firmware Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ISP Flashing Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="../README.md" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../zh-cn/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../es/" hreflang="es" class="md-select__link">
                    Español
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../fr-fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../he-il/" hreflang="he" class="md-select__link">
                    עברית
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../pt-br/" hreflang="pt" class="md-select__link">
                    Português
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ru-ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ja/" hreflang="ja" class="md-select__link">
                    日本語
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Quantum Mechanical Keyboard Firmware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QMK Firmware Docs" class="md-nav__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    QMK Firmware Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Quantum Mechanical Keyboard Firmware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dealing-with-corrupted-bootloaders" class="md-nav__link">
    Dealing with Corrupted Bootloaders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-needed" class="md-nav__link">
    Hardware Needed
  </a>
  
    <nav class="md-nav" aria-label="Hardware Needed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-isp-firmware" class="md-nav__link">
    The ISP Firmware
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-needed" class="md-nav__link">
    Software Needed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wiring" class="md-nav__link">
    Wiring
  </a>
  
    <nav class="md-nav" aria-label="Wiring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sparkfun-pocket-avr" class="md-nav__link">
    SparkFun Pocket AVR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usbasp" class="md-nav__link">
    USBasp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teensy-20" class="md-nav__link">
    Teensy 2.0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pro-micro" class="md-nav__link">
    Pro Micro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flashing-your-keyboard" class="md-nav__link">
    Flashing Your Keyboard
  </a>
  
    <nav class="md-nav" aria-label="Flashing Your Keyboard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-bootloader-file" class="md-nav__link">
    The Bootloader File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-techniques" class="md-nav__link">
    Production Techniques
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flashing-your-bootloaderproduction-file" class="md-nav__link">
    Flashing Your Bootloader/Production File
  </a>
  
    <nav class="md-nav" aria-label="Flashing Your Bootloader/Production File">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qmk-toolbox" class="md-nav__link">
    QMK Toolbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    Command Line
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#help" class="md-nav__link">
    Help
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qmk/qmk_firmware/edit/master/docs/isp_flashing_guide.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="isp-flashing-guide">ISP Flashing Guide<a class="headerlink" href="#isp-flashing-guide" title="Permanent link">&para;</a></h1>
<p>ISP flashing (also known as ICSP flashing) is the process of programming a microcontroller directly.  This allows you to replace the bootloader, or change the "fuses" on the controller, which control a number of hardware- and software-related functions, such as the speed of the controller, how it boots, and other options.  </p>
<p>The main use of ISP flashing for QMK is flashing or replacing the bootloader on your AVR-based controller (Pro Micros, or V-USB chips).  </p>
<p>?&gt; This is only for programming AVR based boards, such as the Pro Micro or other ATmega controllers.  It is not for Arm controllers, such as the Proton C. </p>
<h2 id="dealing-with-corrupted-bootloaders">Dealing with Corrupted Bootloaders<a class="headerlink" href="#dealing-with-corrupted-bootloaders" title="Permanent link">&para;</a></h2>
<p>If you're having trouble flashing/erasing your board, and running into cryptic error messages like any of the following for a DFU based controller:</p>
<div class="codehilite"><pre><span></span><code>libusb: warning [darwin_transfer_status] transfer error: timed out
dfu.c:844: -ETIMEDOUT: Transfer timed out, NAK 0xffffffc4 (-60)
atmel.c:1627: atmel_flash: flash data dfu_download failed.
atmel.c:1629: Expected message length of 1072, got -60.
atmel.c:1434: Error flashing the block: err -2.
ERROR
Memory write error, use debug for more info.
commands.c:360: Error writing memory data. (err -4)

dfu.c:844: -EPIPE: a) Babble detect or b) Endpoint stalled 0xffffffe0 (-32)
Device is write protected.
dfu.c:252: dfu_clear_status( 0x7fff4fc2ea80 )
atmel.c:1434: Error flashing the block: err -2.
ERROR
Memory write error, use debug for more info.
commands.c:360: Error writing memory data. (err -4)
</code></pre></div>

<p>Or, if you see this sort of message for a Pro Micro based controller:</p>
<div class="codehilite"><pre><span></span><code>avrdude: butterfly_recv(): programmer is not responding
avrdude: butterfly_recv(): programmer is not responding
avrdude: verification error, first mismatch at byte 0x002a
        0x2b != 0x75
avrdude: verification error; content mismatch
avrdude: verification error; content mismatch
</code></pre></div>

<p>You're likely going to need to ISP flash your board/device to get it working again. </p>
<h2 id="hardware-needed">Hardware Needed<a class="headerlink" href="#hardware-needed" title="Permanent link">&para;</a></h2>
<p>You'll need one of the following to actually perform the ISP flashing (followed by the protocol they use):</p>
<ul>
<li><a href="https://www.sparkfun.com/products/9825">SparkFun PocketAVR</a> - (USB Tiny)</li>
<li><a href="https://www.adafruit.com/product/46">USBtinyISP AVR Programmer Kit</a> - (USB Tiny)</li>
<li><a href="https://www.fischl.de/usbasp/">USBasp</a> - (usbasp)</li>
<li><a href="https://www.pjrc.com/store/teensy.html">Teensy 2.0</a> - (avrisp)</li>
<li><a href="https://www.sparkfun.com/products/12640">Pro Micro</a>  - (avrisp)</li>
<li><a href="https://www.adafruit.com/product/237">Bus Pirate</a> - (buspirate)</li>
</ul>
<p>There are other devices that can be used to ISP flash, but these are the main ones.  Also, all product links are to the official versions. You can source them elsewhere. </p>
<p>You'll also need something to wire your "ISP Programmer" to the device that you're programming.  Some PCBs may have ISP headers that you can use directly, but this often isn't the case, so you'll likely need to solder to the controller itself or to different switches or other components. </p>
<h3 id="the-isp-firmware">The ISP Firmware<a class="headerlink" href="#the-isp-firmware" title="Permanent link">&para;</a></h3>
<p>The Teensy and Pro Micro controllers will need you to flash the ISP firmware to the controllers before you can use them as an ISP programmer.  The rest of the hardware should come preprogrammed.  So, for these controllers, download the correct hex file, and flash it first. </p>
<ul>
<li>Teensy 2.0: <a href="https://github.com/qmk/qmk_firmware/blob/master/util/teensy_2.0_ISP_B0.hex"><code>util/teensy_2.0_ISP_B0.hex</code></a> (<code>B0</code>)</li>
<li>Pro Micro: <a href="https://github.com/qmk/qmk_firmware/blob/master/util/pro_micro_ISP_B6_10.hex"><code>util/pro_micro_ISP_B6_10.hex</code></a> (<code>10/B6</code>)</li>
</ul>
<p>Once you've flashed your controller, you won't need this hex file anymore. </p>
<h2 id="software-needed">Software Needed<a class="headerlink" href="#software-needed" title="Permanent link">&para;</a></h2>
<p>The QMK Toolbox can be used for most (all) of this.  </p>
<p>However, you can grab the <a href="https://www.pjrc.com/teensy/loader.html">Teensy Loader</a> to flash your Teensy 2.0 board, if you are using that. Or you can use <code>avrdude</code> (installed as part of <code>qmk_install.sh</code>), or <a href="https://blog.zakkemble.net/avrdudess-a-gui-for-avrdude/">AVRDUDESS</a> (for Windows) to flash the Pro Micro, and the ISP flashing. </p>
<h2 id="wiring">Wiring<a class="headerlink" href="#wiring" title="Permanent link">&para;</a></h2>
<p>This is pretty straight-forward - we'll be connecting like-things to like-things in the following manner.</p>
<h3 id="sparkfun-pocket-avr">SparkFun Pocket AVR<a class="headerlink" href="#sparkfun-pocket-avr" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>PocketAVR RST  &lt;-&gt; Keyboard RESET
PocketAVR SCLK &lt;-&gt; Keyboard B1 (SCLK)
PocketAVR MOSI &lt;-&gt; Keyboard B2 (MOSI)
PocketAVR MISO &lt;-&gt; Keyboard B3 (MISO)
PocketAVR VCC  &lt;-&gt; Keyboard VCC
PocketAVR GND  &lt;-&gt; Keyboard GND
</code></pre></div>

<h3 id="usbasp">USBasp<a class="headerlink" href="#usbasp" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>USBasp RST  &lt;-&gt; Keyboard RESET
USBasp SCLK &lt;-&gt; Keyboard B1 (SCLK)
USBasp MOSI &lt;-&gt; Keyboard B2 (MOSI)
USBasp MISO &lt;-&gt; Keyboard B3 (MISO)
USBasp VCC  &lt;-&gt; Keyboard VCC
USBasp GND  &lt;-&gt; Keyboard GND
</code></pre></div>

<h3 id="teensy-20">Teensy 2.0<a class="headerlink" href="#teensy-20" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>Teensy B0  &lt;-&gt; Keyboard RESET
Teensy B1  &lt;-&gt; Keyboard B1 (SCLK)
Teensy B2  &lt;-&gt; Keyboard B2 (MOSI)
Teensy B3  &lt;-&gt; Keyboard B3 (MISO)
Teensy VCC &lt;-&gt; Keyboard VCC
Teensy GND &lt;-&gt; Keyboard GND
</code></pre></div>

<p>!&gt; Note that the B0 pin on the Teensy is wired to the RESET/RST pin on the keyboard's controller.  <strong><em>DO NOT</em></strong> wire the RESET pin on the Teensy to the RESET on the keyboard. </p>
<h3 id="pro-micro">Pro Micro<a class="headerlink" href="#pro-micro" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>Pro Micro 10 (B6)  &lt;-&gt; Keyboard RESET
Pro Micro 15 (B1)  &lt;-&gt; Keyboard B1 (SCLK)
Pro Micro 16 (B2)  &lt;-&gt; Keyboard B2 (MOSI)
Pro Micro 14 (B3)  &lt;-&gt; Keyboard B3 (MISO)
Pro Micro VCC      &lt;-&gt; Keyboard VCC
Pro Micro GND      &lt;-&gt; Keyboard GND
</code></pre></div>

<p>!&gt; Note that the 10/B6 pin on the Pro Micro is wired to the RESET/RST pin on the keyboard's controller.  <strong><em>DO NOT</em></strong> wire the RESET pin on the Pro Micro to the RESET on the keyboard. </p>
<h2 id="flashing-your-keyboard">Flashing Your Keyboard<a class="headerlink" href="#flashing-your-keyboard" title="Permanent link">&para;</a></h2>
<p>After you have your ISP programmer set up, and wired to your keyboard, it's time to flash your keyboard.  </p>
<h3 id="the-bootloader-file">The Bootloader File<a class="headerlink" href="#the-bootloader-file" title="Permanent link">&para;</a></h3>
<p>The simplest and quickest way to get things back to normal is to flash only a bootloader to the keyboard. Once this is done, you can connect the keyboard normally and flash the keyboard like you normally would. </p>
<p>You can find the stock bootloaders in the <a href="https://github.com/qmk/qmk_firmware/tree/master/util"><code>util/</code> folder</a>. Be sure to flash the correct bootloader for your chip:</p>
<ul>
<li><strong>Atmel DFU</strong></li>
<li><a href="https://github.com/qmk/qmk_firmware/blob/master/util/bootloader_atmega16u4_1.0.1.hex">ATmega16U4</a></li>
<li><a href="https://github.com/qmk/qmk_firmware/blob/master/util/bootloader_atmega32u4_1.0.0.hex">ATmega32U4</a></li>
<li><a href="https://github.com/qmk/qmk_firmware/blob/master/util/bootloader_at90usb64_1.0.0.hex">AT90USB64</a></li>
<li><a href="https://github.com/qmk/qmk_firmware/blob/master/util/bootloader_at90usb128_1.0.1.hex">AT90USB128</a></li>
<li><strong>Caterina</strong></li>
<li><a href="https://github.com/sparkfun/Arduino_Boards/blob/master/sparkfun/avr/bootloaders/caterina/Caterina-promicro16.hex">Pro Micro (5V/16MHz)</a></li>
<li><a href="https://github.com/sparkfun/Arduino_Boards/blob/master/sparkfun/avr/bootloaders/caterina/Caterina-promicro8.hex">Pro Micro (3.3V/8MHz)</a></li>
<li><strong>BootloadHID (PS2AVRGB)</strong></li>
<li><a href="https://github.com/qmk/qmk_firmware/blob/master/util/bootloader_ps2avrgb_bootloadhid_1.0.1.hex">ATmega32A</a></li>
</ul>
<p>If you're not sure what your board uses, look in the <code>rules.mk</code> file for the keyboard in QMK. The <code>MCU</code> and <code>BOOTLOADER</code> lines will have the value you need. It may differ between different versions of the board.</p>
<h3 id="production-techniques">Production Techniques<a class="headerlink" href="#production-techniques" title="Permanent link">&para;</a></h3>
<p>If you'd like to flash both the bootloader <strong>and</strong> the regular firmware at the same time, there are two options to do so.  Manually, or with the <code>:production</code> target when compiling. </p>
<p>To do this manually: </p>
<ol>
<li>Open the original firmware .hex file in a text editor</li>
<li>Remove the last line (which should be <code>:00000001FF</code> - this is an EOF message)</li>
<li>Copy the entire bootloader's contents onto a new line (with no empty lines between) and paste it at the end of the original file</li>
<li>Save it as a new file by naming it <code>&lt;keyboard&gt;_&lt;keymap&gt;_production.hex</code></li>
</ol>
<p>?&gt; It's possible to use other bootloaders here in the same way, but <strong>you need a bootloader</strong>, otherwise you'll have to use ISP again to write new firmware to your keyboard.</p>
<h4 id="create-qmk-dfu-bootloader-and-production-images">Create QMK DFU Bootloader and Production images<a class="headerlink" href="#create-qmk-dfu-bootloader-and-production-images" title="Permanent link">&para;</a></h4>
<p>You can create the firmware, the QMK DFU Bootloader and the production firmware images for the board using the <code>:production</code> target when compiling.  Once this is done, you'll see three files: 
* <code>&lt;keyboard&gt;_&lt;keymap&gt;.hex</code>
* <code>&lt;keyboard&gt;_&lt;keymap&gt;_bootloader.hex</code>
* <code>&lt;keyboard&gt;_&lt;keymap&gt;_production.hex</code></p>
<p>The QMK DFU bootloader has only really been tested on <code>atmega32u4</code> controllers (such as the AVR based Planck boards, and the Pro Micro), and hasn't been tested on other controllers.  However, it will definitely not work on V-USB controllers, such as the <code>atmega32a</code> or <code>atmega328p</code>.</p>
<p>You can flash either the bootloader or the production firmware file. The production firmware file will take a lot longer to flash, since it's flashing a lot more data. </p>
<p>?&gt; Note: You should stay with the same bootloader. If you're using DFU already, switching to QMK DFU is fine. But flashing QMK DFU onto a Pro Micro, for instance, has additional steps needed.</p>
<h2 id="flashing-your-bootloaderproduction-file">Flashing Your Bootloader/Production File<a class="headerlink" href="#flashing-your-bootloaderproduction-file" title="Permanent link">&para;</a></h2>
<p>Make sure your keyboard is unplugged from any device, and plug in your ISP Programmer.</p>
<p>If you want to change bootloader types, You'll need to use the command line. </p>
<h3 id="qmk-toolbox">QMK Toolbox<a class="headerlink" href="#qmk-toolbox" title="Permanent link">&para;</a></h3>
<ol>
<li><code>AVRISP device connected</code> or <code>USB Tiny device connected</code> will show up in yellow</li>
<li>Select the correct bootloader/production .hex file with the <code>Open</code> dialog (spaces can't be in the path)</li>
<li>Be sure the correct <code>Microcontroller</code> option for the keyboard you're flashing (not the ISP programmer) is selected</li>
<li>Hit <code>Flash</code></li>
<li>Wait, as nothing will output for a while, especially with production files</li>
</ol>
<p>If the verification and fuse checks are ok, you're done! Your board may restart automatically, otherwise, unplug your Teensy and plug in your keyboard - you can leave your Teensy wired to your keyboard while testing things, but it's recommended that you desolder it/remove the wiring once you're sure everything works.</p>
<h3 id="command-line">Command Line<a class="headerlink" href="#command-line" title="Permanent link">&para;</a></h3>
<p>Open a terminal (<code>cmd</code> on Windows, for instance) and navigate to your where your modified .hex file is. We'll pretend this file is called <code>main.hex</code>, and that your Teensy 2.0 is on the <code>COM3</code> port - if you're unsure, you can open your Device Manager, and look for <code>Ports &gt; USB Serial Device</code>. Use that COM port here. You can confirm it's the right port with:</p>
<div class="codehilite"><pre><span></span><code>avrdude -c avrisp -P COM3 -p atmega32u4
</code></pre></div>

<p>and you should get something like the following output:</p>
<div class="codehilite"><pre><span></span><code>avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.02s

avrdude: Device signature = 0x1e9587

avrdude: safemode: Fuses OK

avrdude done.  Thank you.
</code></pre></div>

<p>Since our keyboard uses an <code>atmega32u4</code> (common), that is the chip we'll specify. This is the full command:</p>
<div class="codehilite"><pre><span></span><code>avrdude -c avrisp -P COM3 -p atmega32u4 -U flash:w:main.hex:i
</code></pre></div>

<p>If your board uses an <code>atmega32a</code> (e.g. on a jj40), the command is this (the extra code at the end sets the fuses correctly):</p>
<div class="codehilite"><pre><span></span><code>avrdude -c avrisp -P COM3 -p atmega32 -U flash:w:main.hex:i -U hfuse:w:0xD0:m -U lfuse:w:0x0F:m
</code></pre></div>

<p>You should see a couple of progress bars, then you should see:</p>
<div class="codehilite"><pre><span></span><code>avrdude: verifying ...
avrdude: 32768 bytes of flash verified

avrdude: safemode: Fuses OK

avrdude done.  Thank you.
</code></pre></div>

<p>Which means everything should be ok! Your board may restart automatically, otherwise, unplug your Teensy and plug in your keyboard - you can leave your Teensy wired to your keyboard while testing things, but it's recommended that you desolder it/remove the wiring once you're sure everything works.</p>
<p>If you're using a SparkFun PocketAVR Programmer, or another USB Tiny based ISP programmer, you will want to use something like this: </p>
<div class="codehilite"><pre><span></span><code>avrdude -c usbtiny -P usb -p atmega32u4
</code></pre></div>

<h4 id="advanced-changing-fuses">Advanced: Changing Fuses<a class="headerlink" href="#advanced-changing-fuses" title="Permanent link">&para;</a></h4>
<p>If you're switching bootloaders, such as flashing QMK DFU on a Pro Micro, you will need to change the fuses, in additional to flashing the bootloader hex file.  This is because <code>caterina</code> (the Pro Micro bootloader) and <code>dfu</code> handle the startup routines differently, and that behavior is controlled by the fuses.  </p>
<p>!&gt; This is one area that it is very important to be careful, as changing fuses is one of the ways that you can permanently brick your controller.  </p>
<p>For this, we are assuming the 5V 16MHz versions of the <code>atmega32u4</code> (such as the 5V Pro Micro).</p>
<p>For DFU on the <code>atmega32u4</code>, these are the fuse settings that you want: </p>
<table>
<thead>
<tr>
<th>Fuse</th>
<th>Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td>Low</td>
<td><code>0x5E</code></td>
</tr>
<tr>
<td>High</td>
<td><code>0xD9</code> or <code>0x99</code></td>
</tr>
<tr>
<td>Extended</td>
<td><code>0xC3</code></td>
</tr>
</tbody>
</table>
<p>The High fuse can be 0xD9 or 0x99. The difference is that 0xD9 disables JTAG, which QMK Firmware disables via software as well, while 0x99 doesn't disable JTAG. </p>
<p>To set this add <code>-U lfuse:w:0x5E:m -U hfuse:w:0xD9:m -U efuse:w:0xC3:m</code> to your command.  So the final command should look something like: </p>
<div class="codehilite"><pre><span></span><code>avrdude -c avrisp -P COM3 -p atmega32u4 -U flash:w:main.hex:i -U lfuse:w:0x5E:m -U hfuse:w:0xD9:m -U efuse:w:0xC3:m
</code></pre></div>

<p>For Caterina on the <code>atmega32u4</code>, these are the fuse settings that you want: </p>
<table>
<thead>
<tr>
<th>Fuse</th>
<th>Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td>Low</td>
<td><code>0xFF</code></td>
</tr>
<tr>
<td>High</td>
<td><code>0xD8</code></td>
</tr>
<tr>
<td>Extended</td>
<td><code>0xCB</code></td>
</tr>
</tbody>
</table>
<p>To set this add <code>-U lfuse:w:0xFF:m -U hfuse:w:0xD8:m -U efuse:w:0xCB:m</code> to your command.  So the final command should look something like: </p>
<div class="codehilite"><pre><span></span><code>avrdude -c avrisp -P COM3 -p atmega32u4 -U flash:w:main.hex:i -U lfuse:w:0xFF:m -U hfuse:w:0xD8:m -U efuse:w:0xCB:m
</code></pre></div>

<p>If you are using a different controller or want different configuration, you can use <a href="https://www.engbedded.com/fusecalc/">this AVR Fuse Calculator</a> to find a better value for you.</p>
<h2 id="help">Help<a class="headerlink" href="#help" title="Permanent link">&para;</a></h2>
<p>If you have any questions/problems, feel free to <a href="https://github.com/qmk/qmk_firmware/issues/new">open an issue</a>!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>