
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.qmk.fm/0.13/ws2812_driver/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>WS2812 Driver - QMK Firmware Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ws2812-driver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QMK Firmware Docs" class="md-header__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMK Firmware Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WS2812 Driver
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh-cn/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/es/" hreflang="es" class="md-select__link">
                    Español
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/fr-fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/he-il/" hreflang="he" class="md-select__link">
                    עברית
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/pt-br/" hreflang="pt" class="md-select__link">
                    Português
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/ru-ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/ja/" hreflang="ja" class="md-select__link">
                    日本語
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Quantum Mechanical Keyboard Firmware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QMK Firmware Docs" class="md-nav__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    QMK Firmware Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Quantum Mechanical Keyboard Firmware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-driver-types" class="md-nav__link">
    Supported Driver Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#driver-configuration" class="md-nav__link">
    Driver configuration
  </a>
  
    <nav class="md-nav" aria-label="Driver configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#all-drivers" class="md-nav__link">
    All drivers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitbang" class="md-nav__link">
    Bitbang
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i2c" class="md-nav__link">
    I2C
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi" class="md-nav__link">
    SPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pwm" class="md-nav__link">
    PWM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-pull-and-open-drain-configuration" class="md-nav__link">
    Push Pull and Open Drain Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qmk/qmk_firmware/edit/master/docs/ws2812_driver.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="ws2812-driver">WS2812 Driver<a class="headerlink" href="#ws2812-driver" title="Permanent link">&para;</a></h1>
<p>This driver powers the <a href="../feature_rgblight/">RGB Lighting</a> and <a href="../feature_rgb_matrix/">RGB Matrix</a> features.</p>
<p>Currently QMK supports the following addressable LEDs (however, the white LED in RGBW variants is not supported):</p>
<div class="codehilite"><pre><span></span><code>WS2811, WS2812, WS2812B, WS2812C, etc.
SK6812, SK6812MINI, SK6805
</code></pre></div>

<p>These LEDs are called "addressable" because instead of using a wire per color, each LED contains a small microchip that understands a special protocol sent over a single wire. The chip passes on the remaining data to the next LED, allowing them to be chained together. In this way, you can easily control the color of the individual LEDs.</p>
<h2 id="supported-driver-types">Supported Driver Types<a class="headerlink" href="#supported-driver-types" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th></th>
<th>AVR</th>
<th>ARM</th>
</tr>
</thead>
<tbody>
<tr>
<td>bit bang</td>
<td>:heavy_check_mark:</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>I2C</td>
<td>:heavy_check_mark:</td>
<td></td>
</tr>
<tr>
<td>SPI</td>
<td></td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>PWM</td>
<td></td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>
<h2 id="driver-configuration">Driver configuration<a class="headerlink" href="#driver-configuration" title="Permanent link">&para;</a></h2>
<h3 id="all-drivers">All drivers<a class="headerlink" href="#all-drivers" title="Permanent link">&para;</a></h3>
<p>Different versions of the addressable LEDs have differing requirements for the T<sub>RST</sub> period between frames.
The default setting is 280 µs, which should work for most cases, but this can be overridden in your config.h. e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_TRST_US 80</span>
</code></pre></div>

<h4 id="byte-order">Byte Order<a class="headerlink" href="#byte-order" title="Permanent link">&para;</a></h4>
<p>Some variants of the WS2812 may have their color components in a different physical or logical order. For example, the WS2812B-2020 has physically swapped red and green LEDs, which causes the wrong color to be displayed, because the default order of the bytes sent over the wire is defined as GRB.
In this case, you can change the byte order by defining <code>WS2812_BYTE_ORDER</code> as one of the following values:</p>
<table>
<thead>
<tr>
<th>Byte order</th>
<th>Known devices</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WS2812_BYTE_ORDER_GRB</code> (default)</td>
<td>Most WS2812's, SK6812, SK6805</td>
</tr>
<tr>
<td><code>WS2812_BYTE_ORDER_RGB</code></td>
<td>WS2812B-2020</td>
</tr>
<tr>
<td><code>WS2812_BYTE_ORDER_BGR</code></td>
<td>TM1812</td>
</tr>
</tbody>
</table>
<h3 id="bitbang">Bitbang<a class="headerlink" href="#bitbang" title="Permanent link">&para;</a></h3>
<p>Default driver, the absence of configuration assumes this driver. To configure it, add this to your rules.mk:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">WS2812_DRIVER</span> <span class="o">=</span> bitbang
</code></pre></div>

<p>!&gt; This driver is not hardware accelerated and may not be performant on heavily loaded systems.</p>
<h3 id="i2c">I2C<a class="headerlink" href="#i2c" title="Permanent link">&para;</a></h3>
<p>Targeting boards where WS2812 support is offloaded to a 2nd MCU. Currently the driver is limited to AVR given the known consumers are ps2avrGB/BMC. To configure it, add this to your rules.mk:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">WS2812_DRIVER</span> <span class="o">=</span> i2c
</code></pre></div>

<p>Configure the hardware via your config.h:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_ADDRESS 0xb0 </span><span class="c1">// default: 0xb0</span>
<span class="cp">#define WS2812_TIMEOUT 100 </span><span class="c1">// default: 100</span>
</code></pre></div>

<h3 id="spi">SPI<a class="headerlink" href="#spi" title="Permanent link">&para;</a></h3>
<p>Targeting STM32 boards where WS2812 support is offloaded to an SPI hardware device. The advantage is that the use of DMA offloads processing of the WS2812 protocol from the MCU. <code>RGB_DI_PIN</code> for this driver is the configured SPI MOSI pin. Due to the nature of repurposing SPI to drive the LEDs, the other SPI pins, MISO and SCK, <strong>must</strong> remain unused. To configure it, add this to your rules.mk:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">WS2812_DRIVER</span> <span class="o">=</span> spi
</code></pre></div>

<p>Configure the hardware via your config.h:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_SPI SPID1 </span><span class="c1">// default: SPID1</span>
<span class="cp">#define WS2812_SPI_MOSI_PAL_MODE 5 </span><span class="c1">// MOSI pin &quot;alternate function&quot;, see the respective datasheet for the appropriate values for your MCU. default: 5</span>
<span class="cp">#define WS2812_SPI_SCK_PIN B3 </span><span class="c1">// Required for F072, may be for others -- SCK pin, see the respective datasheet for the appropriate values for your MCU. default: unspecified</span>
<span class="cp">#define WS2812_SPI_SCK_PAL_MODE 5 </span><span class="c1">// SCK pin &quot;alternate function&quot;, see the respective datasheet for the appropriate values for your MCU. default: 5</span>
</code></pre></div>

<p>You must also turn on the SPI feature in your halconf.h and mcuconf.h</p>
<h4 id="circular-buffer-mode">Circular Buffer Mode<a class="headerlink" href="#circular-buffer-mode" title="Permanent link">&para;</a></h4>
<p>Some boards may flicker while in the normal buffer mode. To fix this issue, circular buffer mode may be used to rectify the issue. </p>
<p>By default, the circular buffer mode is disabled.</p>
<p>To enable this alternative buffer mode, place this into your <code>config.h</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_SPI_USE_CIRCULAR_BUFFER</span>
</code></pre></div>

<h4 id="setting-baudrate-with-divisor">Setting baudrate with divisor<a class="headerlink" href="#setting-baudrate-with-divisor" title="Permanent link">&para;</a></h4>
<p>To adjust the baudrate at which the SPI peripheral is configured, users will need to derive the target baudrate from the clock tree provided by STM32CubeMX.</p>
<p>Only divisors of 2, 4, 8, 16, 32, 64, 128 and 256 are supported by hardware.</p>
<table>
<thead>
<tr>
<th>Define</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WS2812_SPI_DIVISOR</code></td>
<td><code>16</code></td>
<td>SPI source clock peripheral divisor</td>
</tr>
</tbody>
</table>
<h4 id="testing-notes">Testing Notes<a class="headerlink" href="#testing-notes" title="Permanent link">&para;</a></h4>
<p>While not an exhaustive list, the following table provides the scenarios that have been partially validated:</p>
<table>
<thead>
<tr>
<th></th>
<th>SPI1</th>
<th>SPI2</th>
<th>SPI3</th>
</tr>
</thead>
<tbody>
<tr>
<td>f072</td>
<td>?</td>
<td>B15 :heavy_check_mark: (needs SCK: B13)</td>
<td>N/A</td>
</tr>
<tr>
<td>f103</td>
<td>A7 :heavy_check_mark:</td>
<td>B15 :heavy_check_mark:</td>
<td>N/A</td>
</tr>
<tr>
<td>f303</td>
<td>A7 :heavy_check_mark: B5 :heavy_check_mark:</td>
<td>B15 :heavy_check_mark:</td>
<td>B5 :heavy_check_mark:</td>
</tr>
</tbody>
</table>
<p><em>Other supported ChibiOS boards and/or pins may function, it will be highly chip and configuration dependent.</em></p>
<h3 id="pwm">PWM<a class="headerlink" href="#pwm" title="Permanent link">&para;</a></h3>
<p>Targeting STM32 boards where WS2812 support is offloaded to an PWM timer and DMA stream. The advantage is that the use of DMA offloads processing of the WS2812 protocol from the MCU. To configure it, add this to your rules.mk:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">WS2812_DRIVER</span> <span class="o">=</span> pwm
</code></pre></div>

<p>Configure the hardware via your config.h:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_PWM_DRIVER PWMD2  </span><span class="c1">// default: PWMD2</span>
<span class="cp">#define WS2812_PWM_CHANNEL 2  </span><span class="c1">// default: 2</span>
<span class="cp">#define WS2812_PWM_PAL_MODE 2  </span><span class="c1">// Pin &quot;alternate function&quot;, see the respective datasheet for the appropriate values for your MCU. default: 2</span>
<span class="c1">//#define WS2812_PWM_COMPLEMENTARY_OUTPUT // Define for a complementary timer output (TIMx_CHyN); omit for a normal timer output (TIMx_CHy).</span>
<span class="cp">#define WS2812_DMA_STREAM STM32_DMA1_STREAM2  </span><span class="c1">// DMA Stream for TIMx_UP, see the respective reference manual for the appropriate values for your MCU.</span>
<span class="cp">#define WS2812_DMA_CHANNEL 2  </span><span class="c1">// DMA Channel for TIMx_UP, see the respective reference manual for the appropriate values for your MCU.</span>
<span class="cp">#define WS2812_DMAMUX_ID STM32_DMAMUX1_TIM2_UP </span><span class="c1">// DMAMUX configuration for TIMx_UP -- only required if your MCU has a DMAMUX peripheral, see the respective reference manual for the appropriate values for your MCU.</span>
</code></pre></div>

<p>Note that using a complementary timer output (TIMx_CHyN) is possible only for advanced-control timers (TIM1, TIM8, TIM20 on STM32), and the <code>STM32_PWM_USE_ADVANCED</code> option in mcuconf.h must be set to <code>TRUE</code>.  Complementary outputs of general-purpose timers are not supported due to ChibiOS limitations.</p>
<p>You must also turn on the PWM feature in your halconf.h and mcuconf.h</p>
<h4 id="testing-notes_1">Testing Notes<a class="headerlink" href="#testing-notes_1" title="Permanent link">&para;</a></h4>
<p>While not an exhaustive list, the following table provides the scenarios that have been partially validated:</p>
<table>
<thead>
<tr>
<th></th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>f072</td>
<td>?</td>
</tr>
<tr>
<td>f103</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>f303</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>f401/f411</td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>
<p><em>Other supported ChibiOS boards and/or pins may function, it will be highly chip and configuration dependent.</em></p>
<h3 id="push-pull-and-open-drain-configuration">Push Pull and Open Drain Configuration<a class="headerlink" href="#push-pull-and-open-drain-configuration" title="Permanent link">&para;</a></h3>
<p>The default configuration is a push pull on the defined pin.
This can be configured for bitbang, PWM and SPI.</p>
<p>Note: This only applies to STM32 boards.</p>
<p>To configure the <code>RGB_DI_PIN</code> to open drain configuration add this to your config.h file: </p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define WS2812_EXTERNAL_PULLUP</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>