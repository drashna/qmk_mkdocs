
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.qmk.fm/0.13/feature_backlight/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Backlighting :id=backlighting - QMK Firmware Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#backlighting-idbacklighting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QMK Firmware Docs" class="md-header__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QMK Firmware Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Backlighting :id=backlighting
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="../README.md" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../zh-cn/" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../es/" hreflang="es" class="md-select__link">
                    Español
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../fr-fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../he-il/" hreflang="he" class="md-select__link">
                    עברית
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../pt-br/" hreflang="pt" class="md-select__link">
                    Português
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ru-ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="../ja/" hreflang="ja" class="md-select__link">
                    日本語
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Quantum Mechanical Keyboard Firmware
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QMK Firmware Docs" class="md-nav__button md-logo" aria-label="QMK Firmware Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    QMK Firmware Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/qmk/qmk_firmware/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    qmk/qmk_firmware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Quantum Mechanical Keyboard Firmware
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#keycodes-idkeycodes" class="md-nav__link">
    Keycodes :id=keycodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions-idfunctions" class="md-nav__link">
    Functions :id=functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-idconfiguration" class="md-nav__link">
    Configuration :id=configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration :id=configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backlight-on-state-idbacklight-on-state" class="md-nav__link">
    Backlight On State :id=backlight-on-state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avr-driver-idavr-driver" class="md-nav__link">
    AVR Driver :id=avr-driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arm-driver-idarm-configuration" class="md-nav__link">
    ARM Driver :id=arm-configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software-pwm-driver-idsoftware-pwm-driver" class="md-nav__link">
    Software PWM Driver :id=software-pwm-driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-driver-idcustom-driver" class="md-nav__link">
    Custom Driver :id=custom-driver
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-schematic" class="md-nav__link">
    Example Schematic
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qmk/qmk_firmware/edit/master/docs/feature_backlight.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="backlighting-idbacklighting">Backlighting :id=backlighting<a class="headerlink" href="#backlighting-idbacklighting" title="Permanent link">&para;</a></h1>
<p>Many keyboards support backlit keys by way of individual LEDs placed through or underneath the keyswitches. This feature is distinct from both the <a href="../feature_rgblight/">RGB underglow</a> and <a href="../feature_rgb_matrix/">RGB matrix</a> features as it usually allows for only a single colour per switch, though you can obviously install multiple different single coloured LEDs on a keyboard.</p>
<p>QMK is able to control the brightness of these LEDs by switching them on and off rapidly in a certain ratio, a technique known as <em>Pulse Width Modulation</em>, or PWM. By altering the duty cycle of the PWM signal, it creates the illusion of dimming.</p>
<p>The MCU can only supply so much current to its GPIO pins. Instead of powering the backlight directly from the MCU, the backlight pin is connected to a transistor or MOSFET that switches the power to the LEDs.</p>
<p>Most keyboards have backlighting enabled by default if they support it, but if it is not working for you, check that your <code>rules.mk</code> includes the following:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_ENABLE</span> <span class="o">=</span> yes
</code></pre></div>

<h2 id="keycodes-idkeycodes">Keycodes :id=keycodes<a class="headerlink" href="#keycodes-idkeycodes" title="Permanent link">&para;</a></h2>
<p>Once enabled, the following keycodes below can be used to change the backlight level.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BL_TOGG</code></td>
<td>Turn the backlight on or off</td>
</tr>
<tr>
<td><code>BL_STEP</code></td>
<td>Cycle through backlight levels</td>
</tr>
<tr>
<td><code>BL_ON</code></td>
<td>Set the backlight to max brightness</td>
</tr>
<tr>
<td><code>BL_OFF</code></td>
<td>Turn the backlight off</td>
</tr>
<tr>
<td><code>BL_INC</code></td>
<td>Increase the backlight level</td>
</tr>
<tr>
<td><code>BL_DEC</code></td>
<td>Decrease the backlight level</td>
</tr>
<tr>
<td><code>BL_BRTG</code></td>
<td>Toggle backlight breathing</td>
</tr>
</tbody>
</table>
<h2 id="functions-idfunctions">Functions :id=functions<a class="headerlink" href="#functions-idfunctions" title="Permanent link">&para;</a></h2>
<p>These functions can be used to change the backlighting in custom code:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backlight_toggle()</code></td>
<td>Turn the backlight on or off</td>
</tr>
<tr>
<td><code>backlight_enable()</code></td>
<td>Turn the backlight on</td>
</tr>
<tr>
<td><code>backlight_disable()</code></td>
<td>Turn the backlight off</td>
</tr>
<tr>
<td><code>backlight_step()</code></td>
<td>Cycle through backlight levels</td>
</tr>
<tr>
<td><code>backlight_increase()</code></td>
<td>Increase the backlight level</td>
</tr>
<tr>
<td><code>backlight_decrease()</code></td>
<td>Decrease the backlight level</td>
</tr>
<tr>
<td><code>backlight_level(x)</code></td>
<td>Sets the backlight level to specified level</td>
</tr>
<tr>
<td><code>get_backlight_level()</code></td>
<td>Return the current backlight level</td>
</tr>
<tr>
<td><code>is_backlight_enabled()</code></td>
<td>Return whether the backlight is currently on</td>
</tr>
</tbody>
</table>
<p>If backlight breathing is enabled (see below), the following functions are also available:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>breathing_toggle()</code></td>
<td>Turn the backlight breathing on or off</td>
</tr>
<tr>
<td><code>breathing_enable()</code></td>
<td>Turns on backlight breathing</td>
</tr>
<tr>
<td><code>breathing_disable()</code></td>
<td>Turns off backlight breathing</td>
</tr>
</tbody>
</table>
<h2 id="configuration-idconfiguration">Configuration :id=configuration<a class="headerlink" href="#configuration-idconfiguration" title="Permanent link">&para;</a></h2>
<p>To select which driver to use, configure your <code>rules.mk</code> with the following:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_DRIVER</span> <span class="o">=</span> software
</code></pre></div>

<p>Valid driver values are <code>pwm</code>, <code>software</code>, <code>custom</code> or <code>no</code>. See below for help on individual drivers.</p>
<p>To configure the backlighting, <code>#define</code> these in your <code>config.h</code>:</p>
<table>
<thead>
<tr>
<th>Define</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BACKLIGHT_PIN</code></td>
<td><em>Not defined</em></td>
<td>The pin that controls the LED(s)</td>
</tr>
<tr>
<td><code>BACKLIGHT_LEVELS</code></td>
<td><code>3</code></td>
<td>The number of brightness levels (maximum 31 excluding off)</td>
</tr>
<tr>
<td><code>BACKLIGHT_CAPS_LOCK</code></td>
<td><em>Not defined</em></td>
<td>Enable Caps Lock indicator using backlight (for keyboards without dedicated LED)</td>
</tr>
<tr>
<td><code>BACKLIGHT_BREATHING</code></td>
<td><em>Not defined</em></td>
<td>Enable backlight breathing, if supported</td>
</tr>
<tr>
<td><code>BREATHING_PERIOD</code></td>
<td><code>6</code></td>
<td>The length of one backlight "breath" in seconds</td>
</tr>
<tr>
<td><code>BACKLIGHT_ON_STATE</code></td>
<td><code>1</code></td>
<td>The state of the backlight pin when the backlight is "on" - <code>1</code> for high, <code>0</code> for low</td>
</tr>
<tr>
<td><code>BACKLIGHT_LIMIT_VAL</code></td>
<td><code>255</code></td>
<td>The maximum duty cycle of the backlight -- <code>255</code> allows for full brightness, any lower will decrease the maximum.</td>
</tr>
<tr>
<td><code>BACKLIGHT_DEFAULT_LEVEL</code></td>
<td><code>BACKLIGHT_LEVELS</code></td>
<td>The default backlight level to use upon clearing the EEPROM</td>
</tr>
<tr>
<td><code>BACKLIGHT_DEFAULT_BREATHING</code></td>
<td><em>Not defined</em></td>
<td>Whether to enable backlight breathing upon clearing the EEPROM</td>
</tr>
</tbody>
</table>
<p>Unless you are designing your own keyboard, you generally should not need to change the <code>BACKLIGHT_PIN</code> or <code>BACKLIGHT_ON_STATE</code>.</p>
<h3 id="backlight-on-state-idbacklight-on-state">Backlight On State :id=backlight-on-state<a class="headerlink" href="#backlight-on-state-idbacklight-on-state" title="Permanent link">&para;</a></h3>
<p>Most backlight circuits are driven by an N-channel MOSFET or NPN transistor. This means that to turn the transistor <em>on</em> and light the LEDs, you must drive the backlight pin, connected to the gate or base, <em>high</em>.
Sometimes, however, a P-channel MOSFET, or a PNP transistor is used. In this case, when the transistor is on, the pin is driven <em>low</em> instead.</p>
<p>This functionality is configured at the keyboard level with the <code>BACKLIGHT_ON_STATE</code> define.</p>
<h3 id="avr-driver-idavr-driver">AVR Driver :id=avr-driver<a class="headerlink" href="#avr-driver-idavr-driver" title="Permanent link">&para;</a></h3>
<p>The <code>pwm</code> driver is configured by default, however the equivalent setting within <code>rules.mk</code> would be:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_DRIVER</span> <span class="o">=</span> pwm
</code></pre></div>

<h4 id="caveats-idavr-caveats">Caveats :id=avr-caveats<a class="headerlink" href="#caveats-idavr-caveats" title="Permanent link">&para;</a></h4>
<p>On AVR boards, QMK automatically decides which driver to use according to the following table:</p>
<table>
<thead>
<tr>
<th>Backlight Pin</th>
<th>AT90USB64/128</th>
<th>AT90USB162</th>
<th>ATmega16/32U4</th>
<th>ATmega16/32U2</th>
<th>ATmega32A</th>
<th>ATmega328/P</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>B1</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Timer 1</td>
</tr>
<tr>
<td><code>B2</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Timer 1</td>
</tr>
<tr>
<td><code>B5</code></td>
<td>Timer 1</td>
<td></td>
<td>Timer 1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>B6</code></td>
<td>Timer 1</td>
<td></td>
<td>Timer 1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>B7</code></td>
<td>Timer 1</td>
<td>Timer 1</td>
<td>Timer 1</td>
<td>Timer 1</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>C4</code></td>
<td>Timer 3</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>C5</code></td>
<td>Timer 3</td>
<td>Timer 1</td>
<td></td>
<td>Timer 1</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>C6</code></td>
<td>Timer 3</td>
<td>Timer 1</td>
<td>Timer 3</td>
<td>Timer 1</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>D4</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Timer 1</td>
<td></td>
</tr>
<tr>
<td><code>D5</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Timer 1</td>
<td></td>
</tr>
</tbody>
</table>
<p>All other pins will use timer-assisted software PWM:</p>
<table>
<thead>
<tr>
<th>Audio Pin</th>
<th>Audio Timer</th>
<th>Software PWM Timer</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>C4</code></td>
<td>Timer 3</td>
<td>Timer 1</td>
</tr>
<tr>
<td><code>C5</code></td>
<td>Timer 3</td>
<td>Timer 1</td>
</tr>
<tr>
<td><code>C6</code></td>
<td>Timer 3</td>
<td>Timer 1</td>
</tr>
<tr>
<td><code>B5</code></td>
<td>Timer 1</td>
<td>Timer 3</td>
</tr>
<tr>
<td><code>B6</code></td>
<td>Timer 1</td>
<td>Timer 3</td>
</tr>
<tr>
<td><code>B7</code></td>
<td>Timer 1</td>
<td>Timer 3</td>
</tr>
</tbody>
</table>
<p>When both timers are in use for Audio, the backlight PWM cannot use a hardware timer, and will instead be triggered during the matrix scan. In this case, breathing is not supported, and the backlight might flicker, because the PWM computation may not be called with enough timing precision.</p>
<h4 id="hardware-pwm-implementation-idhardware-pwm-implementation">Hardware PWM Implementation :id=hardware-pwm-implementation<a class="headerlink" href="#hardware-pwm-implementation-idhardware-pwm-implementation" title="Permanent link">&para;</a></h4>
<p>When using the supported pins for backlighting, QMK will use a hardware timer configured to output a PWM signal. This timer will count up to <code>ICRx</code> (by default <code>0xFFFF</code>) before resetting to 0.
The desired brightness is calculated and stored in the <code>OCRxx</code> register. When the counter reaches this value, the backlight pin will go low, and is pulled high again when the counter resets.
In this way <code>OCRxx</code> essentially controls the duty cycle of the LEDs, and thus the brightness, where <code>0x0000</code> is completely off and <code>0xFFFF</code> is completely on.</p>
<p>The breathing effect is achieved by registering an interrupt handler for <code>TIMER1_OVF_vect</code> that is called whenever the counter resets, roughly 244 times per second.
In this handler, the value of an incrementing counter is mapped onto a precomputed brightness curve. To turn off breathing, the interrupt handler is simply disabled, and the brightness reset to the level stored in EEPROM.</p>
<h4 id="timer-assisted-pwm-implementation-idtimer-assisted-implementation">Timer Assisted PWM Implementation :id=timer-assisted-implementation<a class="headerlink" href="#timer-assisted-pwm-implementation-idtimer-assisted-implementation" title="Permanent link">&para;</a></h4>
<p>When <code>BACKLIGHT_PIN</code> is not set to a hardware backlight pin, QMK will use a hardware timer configured to trigger software interrupts. This time will count up to <code>ICRx</code> (by default <code>0xFFFF</code>) before resetting to 0.
When resetting to 0, the CPU will fire an OVF (overflow) interrupt that will turn the LEDs on, starting the duty cycle.
The desired brightness is calculated and stored in the <code>OCRxx</code> register. When the counter reaches this value, the CPU will fire a Compare Output match interrupt, which will turn the LEDs off.
In this way <code>OCRxx</code> essentially controls the duty cycle of the LEDs, and thus the brightness, where <code>0x0000</code> is completely off and <code>0xFFFF</code> is completely on.</p>
<p>The breathing effect is the same as in the hardware PWM implementation.</p>
<h3 id="arm-driver-idarm-configuration">ARM Driver :id=arm-configuration<a class="headerlink" href="#arm-driver-idarm-configuration" title="Permanent link">&para;</a></h3>
<p>While still in its early stages, ARM backlight support aims to eventually have feature parity with AVR. The <code>pwm</code> driver is configured by default, however the equivalent setting within <code>rules.mk</code> would be:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_DRIVER</span> <span class="o">=</span> pwm
</code></pre></div>

<h4 id="chibios-configuration-idarm-configuration">ChibiOS Configuration :id=arm-configuration<a class="headerlink" href="#chibios-configuration-idarm-configuration" title="Permanent link">&para;</a></h4>
<p>The following <code>#define</code>s apply only to ARM-based keyboards:</p>
<table>
<thead>
<tr>
<th>Define</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BACKLIGHT_PWM_DRIVER</code></td>
<td><code>PWMD4</code></td>
<td>The PWM driver to use</td>
</tr>
<tr>
<td><code>BACKLIGHT_PWM_CHANNEL</code></td>
<td><code>3</code></td>
<td>The PWM channel to use</td>
</tr>
<tr>
<td><code>BACKLIGHT_PAL_MODE</code></td>
<td><code>2</code></td>
<td>The pin alternative function to use</td>
</tr>
</tbody>
</table>
<p>See the ST datasheet for your particular MCU to determine these values. Unless you are designing your own keyboard, you generally should not need to change them.</p>
<h4 id="caveats-idarm-caveats">Caveats :id=arm-caveats<a class="headerlink" href="#caveats-idarm-caveats" title="Permanent link">&para;</a></h4>
<p>Currently only hardware PWM is supported, not timer assisted, and does not provide automatic configuration.</p>
<h3 id="software-pwm-driver-idsoftware-pwm-driver">Software PWM Driver :id=software-pwm-driver<a class="headerlink" href="#software-pwm-driver-idsoftware-pwm-driver" title="Permanent link">&para;</a></h3>
<p>In this mode, PWM is "emulated" while running other keyboard tasks. It offers maximum hardware compatibility without extra platform configuration. The tradeoff is the backlight might jitter when the keyboard is busy. To enable, add this to your <code>rules.mk</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_DRIVER</span> <span class="o">=</span> software
</code></pre></div>

<h4 id="multiple-backlight-pins-idmultiple-backlight-pins">Multiple Backlight Pins :id=multiple-backlight-pins<a class="headerlink" href="#multiple-backlight-pins-idmultiple-backlight-pins" title="Permanent link">&para;</a></h4>
<p>Most keyboards have only one backlight pin which controls all backlight LEDs (especially if the backlight is connected to a hardware PWM pin).
In software PWM, it is possible to define multiple backlight pins, which will be turned on and off at the same time during the PWM duty cycle.</p>
<p>This feature allows to set, for instance, the Caps Lock LED's (or any other controllable LED) brightness at the same level as the other LEDs of the backlight. This is useful if you have mapped Control in place of Caps Lock and you need the Caps Lock LED to be part of the backlight instead of being activated when Caps Lock is on, as it is usually wired to a separate pin from the backlight.</p>
<p>To activate multiple backlight pins, add something like this to your <code>config.h</code>, instead of <code>BACKLIGHT_PIN</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define BACKLIGHT_PINS { F5, B2 }</span>
</code></pre></div>

<h3 id="custom-driver-idcustom-driver">Custom Driver :id=custom-driver<a class="headerlink" href="#custom-driver-idcustom-driver" title="Permanent link">&para;</a></h3>
<p>If none of the above drivers apply to your board (for example, you are using a separate IC to control the backlight), you can implement a custom backlight driver using this simple API provided by QMK. To enable, add this to your <code>rules.mk</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BACKLIGHT_DRIVER</span> <span class="o">=</span> custom
</code></pre></div>

<p>Then implement any of these hooks:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span> <span class="nf">backlight_init_ports</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Optional - runs on startup</span>
    <span class="c1">//   Usually you want to configure pins here</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">backlight_set</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Optional - runs on level change</span>
    <span class="c1">//   Usually you want to respond to the new value</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">backlight_task</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Optional - runs periodically</span>
    <span class="c1">//   Note that this is called in the main keyboard loop,</span>
    <span class="c1">//   so long running actions here can cause performance issues</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="example-schematic">Example Schematic<a class="headerlink" href="#example-schematic" title="Permanent link">&para;</a></h2>
<p>In this typical example, the backlight LEDs are all connected in parallel towards an N-channel MOSFET. Its gate pin is wired to one of the microcontroller's GPIO pins through a 470Ω resistor to avoid ringing.
A pulldown resistor is also placed between the gate pin and ground to keep it at a defined state when it is not otherwise being driven by the MCU.
The values of these resistors are not critical - see <a href="https://electronics.stackexchange.com/q/68748">this Electronics StackExchange question</a> for more information.</p>
<p><img alt="Backlight example circuit" src="https://i.imgur.com/BmAvoUC.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>